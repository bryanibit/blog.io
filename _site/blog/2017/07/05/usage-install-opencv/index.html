<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="于华超">

    <title>OpenCV 3.0 + Install and Usage - 屋顶上的鱼</title>

    <link rel="canonical" href="http://bryanibit/blog/2017/07/05/usage-install-opencv/">

    <!-- Icons -->
  <link rel="shortcut icon" href="img/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>



<link rel="shortcut icon" type="image/png" href="img/favicon.png">
</link>

<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">屋顶上的鱼</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about/">About</a>
                </li>
                
                <li>
                    <a href="/archive/">Archive</a>
                </li>
                
                <li>
                    <a href="/milestone/">milestone</a>
                </li>
                
                <li>
                    <a href="/tags/">Tags</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/black.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="Tags">
                        
                        <a class="tag" href="/Tags/#技术总结" title="技术总结">技术总结</a>
                        
                    </div>
                    <h1>OpenCV 3.0 + Install and Usage</h1>
                    
                    <span class="meta">Posted by Bryan on July 5, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>




<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container">

                <p>以下方法是编译opencv3.2+contrib部分 使用同样版本的opencv and
opencv_contrib，其中（）中的内容一般没有用,可以去掉, () use CMake’s BUILD_opencv_* options.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    cmake -DCMAKE_BUILD_TYPE=RELEASE -DCMAKE_INSTALL_PREFIX=/usr/local -DBUILD_NEW_PYTHON_SUPPORT=ON -DBUILD_EXAMPLES=ON -DWITH_CUDA=OFF -DWITH_GTK=ON -DOPENCV_EXTRA_MODULES_PATH=&lt;opencv_contrib&gt;/modules (-DBUILD_opencv_legacy=OFF) &lt;opencv_source_directory&gt;
</code></pre>
</div>

<h2 id="python-opencv">Python OpenCV</h2>

<h3 id="feature-detect-and-match">Feature detect and match</h3>
<p><strong>resize</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>img = cv2.resize(img,(0,0), fx = 0.3, fy = 0.3)
</code></pre>
</div>
<p><strong>color to gray</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>gray = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)
</code></pre>
</div>
<p><strong>new zero space</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>image_matche = cv2.cvtColor(np.zeros((image1.shape[0], image1.shape[1] * 2), dtype=np.uint8), cv2.COLOR_GRAY2BGR)
</code></pre>
</div>
<p><strong>SIFT descriptor</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>    if cv2.__version__.split('.')[0] == '2':
        detector = cv2.FeatureDetector_create('SIFT')
        descriptor = cv2.DescriptorExtractor_create('SIFT')
        detector.setDouble("contrastThreshold", 0.1)
        detector.setDouble('edgeThreshold', 10)
        points = detector.detect(gray)
        points, desc = descriptor.compute(gray, points)
    else:
        sift = cv2.xfeatures2d.SIFT_create()
        points, desc = sift.detectAndCompute(gray, None)
</code></pre>
</div>

<p><strong>two feature descriptor above match</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>def match_low(feature1,feature2):
    FLANN_INDEX_KDTREE = 1
    flann_params = dict(algorithm=FLANN_INDEX_KDTREE, tree=4)
    flann = cv2.flann_Index(feature1, flann_params)
    idx, dist = flann.knnSearch(feature2, 2, params={})
    good1 = dist[:, 0] &lt; dist[:, 1] * 0.8 * 0.8
    matches_good1 = zip(idx[good1, 0], good1.nonzero()[0])
    # (a, b) = np.array(matches_good, dtype=int)
    flann = cv2.flann_Index(feature2, flann_params)
    idx, dist = flann.knnSearch(feature1, 2, params={})
    good2 = dist[:, 0] &lt; dist[:, 1] * 0.8 * 0.8
    matches_good2 = zip(idx[good2, 0], good2.nonzero()[0])
    matches1 = [(a, b) for a, b in np.array(matches_good1, dtype=int)]
    matches2 = [(b, a) for a, b in np.array(matches_good2, dtype=int)]
    matches = set(matches1).intersection(matches2)
    return np.array(list(matches), dtype=int)
</code></pre>
</div>
<blockquote>
  <p>note that:
<strong>cv2.flann_Index()</strong></p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>    Summary:
    This method does a fast local approximate nearest neighbors (FLANN) calculation between two sets of feature vectors. The result are two numpy arrays the first one is a list of indexes of the matches and the second one is the match distance value. For the match indices or idx, the index values correspond to the values of td, and the value in the array is the index in td. I.
    I.e. j = idx[i] is where td[i] matches sd[j].
    The second numpy array (dist), at the index i is the match distance between td[i] and sd[j].
    Lower distances mean better matches.
  
    Parameters:
    sd - A numpy array of feature vectors of any size.         (t is template)
    td - A numpy array of feature vectors of any size, this vector is used for indexing
         and the result arrays will have a length matching this vector. (s is source)
  
    Returns:
    Two numpy arrays, the first one, idx, is the idx of the matches of the vector td with sd.
    The second one, dist, is the distance value for the closest match.

    try:
        import cv2
    except:
        logger.warning("Can't run FLANN Matches without OpenCV &gt;= 2.3.0")
        return
    FLANN_INDEX_KDTREE = 1  # bug: flann enums are missing
    flann_params = dict(algorithm = FLANN_INDEX_KDTREE, trees = 4)
    flann = cv2.flann_Index(sd, flann_params)
    idx, dist = flann.knnSearch(td, 1, params = {}) # bug: need to provide empty dict
    del flann
    return idx,dist
</code></pre>
</div>

<h2 id="cpp-opencv">CPP OpenCV</h2>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/blog/2017/07/05/reinstall-ubuntu/" data-toggle="tooltip" data-placement="top" title="Linux Install Tips">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/blog/2017/07/05/alibaba_coding/" data-toggle="tooltip" data-placement="top" title="2018-Alibaba-coding-online">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Duoshuo Share start -->
                <style>
                    .ds-share{
                        text-align: right;
                    }

                    @media only screen and (max-width: 700px) {
                        .ds-share {

                        }
                    }
                </style>

                <div class="ds-share"
                    data-thread-key="/blog/2017/07/05/usage-install-opencv" data-title="OpenCV 3.0 + Install and Usage"
                    data-images="http://bryanibit/img/black.jpg"
                    data-content="以下方法是编译opencv3.2+contrib部分 使用同样版本的opencv and
opencv_contrib，其中（）中的内容一般没有用,可以去... | Microdust:Azeril's blog"
                    data-url="http://bryanibit/blog/2017/07/05/usage-install-opencv/">
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">

                        <!-- <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li> -->
                         <!-- <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>-->
                        <!-- <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li> -->
                        <!-- <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li> -->
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- Duoshuo Share end-->


                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread" data-thread-key="/blog/2017/07/05/usage-install-opencv" data-title="OpenCV 3.0 + Install and Usage" data-url="http://bryanibit/blog/2017/07/05/usage-install-opencv/"></div>
                </div>
                <!-- 多说评论框 end -->
            </div>
        </div>
    </div>
</article>


<!-- mathjax script -->
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"cnfeat"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <!-- kill the Facebook and Weibo -->
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    
                    <!--
                    
                    -->

                    <!--
                    
                    -->

                    
                    <!--
                    
                    -->

                </ul>
                <p class="copyright text-muted">
                &copy; 2017  Bryan ❖ Powered by Jekyll.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>



<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js",function(){
        hljs.initHighlightingOnLoad();
    })
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">


</body>

</html>
